<?xml version="1.0"?>

<PropertyList>

  <enable type="bool">true</enable>

  <!-- global tasks: each of these are run every iteration -->
  <global_tasks>
    <task>
      <name>home_manager</name>
    </task>

    <task>
      <name>lost_link</name>
      <timeout_sec>60</timeout_sec>
      <action_nickname>circle_home</action_nickname>
    </task>

    <task>
      <name>switches</name>
      <switch>
        <input_prop>/sensors/pilot_input/ap_master_switch</input_prop>
        <input_type>normalized</input_type>
        <output_prop>/autopilot/master_switch</output_prop>
        <output_type>boolean</output_type>
      </switch> 
      <switch>
        <input_prop>/sensors/pilot_input/ap_flight_mode</input_prop> -->
        <input_type>normalized</input_type>
        <output_prop>/task/chirp/trigger</output_prop>
        <output_type>boolean</output_type>
      </switch> 
    </task>

    <task>
      <name>throttle_safety</name>
      <safety_on_ground type="bool">false</safety_on_ground>
    </task>

    <task>
      <name>is_airborne</name>
      <!-- "off" in the sense of "off" the ground if we exceed these values -->
      <off_alt_agl_ft>10</off_alt_agl_ft>
      <off_airspeed_kt>15</off_airspeed_kt>
      <!-- "on" the ground if we drop below these values-->
      <on_alt_agl_ft>30</on_alt_agl_ft>
      <on_airspeed_kt>10</on_airspeed_kt>
    </task>
    
    <task>
      <name>flaps_manager</name>
      <speed_secs>5.0</speed_secs>
    </task>

    <task>
      <name>chirp</name>
      <freq_start_rad_sec>2</freq_start_rad_sec>
      <freq_end_rad_sec>30</freq_end_rad_sec>
      <duration_sec>20</duration_sec>
      <amplitude>0.1</amplitude>
      <inject>elevator</inject>
    </task>
  </global_tasks>

  <!-- sequential tasks: only the front item in the fifo queue is run -->
  <sequential_tasks>
    <task>
      <name>launch</name>
      <speed_kt>25</speed_kt>
      <completion_agl_ft>150</completion_agl_ft>
      <mission_agl_ft>400</mission_agl_ft>
      <roll_gain>0.5</roll_gain>
      <roll_limit>5.0</roll_limit>
      <rudder_enable type="bool">true</rudder_enable>
      <rudder_gain>-0.025</rudder_gain>
      <rudder_max>0.5</rudder_max>
    </task>
  </sequential_tasks>

  <!-- standby tasks: a list of tasks that are initialized and configured -->
  <!-- and could be moved to the global or sequential task lists at any -->
  <!-- time. -->
  <standby_tasks>
    <task>
      <name>idle</name>
    </task>

    <task>
      <name>recalibrate</name>
    </task>

    <task>
      <name>preflight</name>
      <duration_sec>60.0</duration_sec>
    </task>

    <task>
      <name>circle</name>
      <nickname>circle_home</nickname>
      <coord_path>/task/home</coord_path>
      <radius_m>100</radius_m>
      <altitude_agl_ft>400</altitude_agl_ft>
      <speed_kt>30</speed_kt>
    </task>

    <task>
      <name>circle</name>
      <nickname>circle_target</nickname>
      <!-- <radius-m>100</radius-m> -->
      <!-- <altitude-agl-ft>400</altitude-agl-ft> -->
      <!-- <speed-kt>30</speed-kt> -->
    </task>
    
    <task>
      <name>route</name>
      <altitude_agl_ft>400</altitude_agl_ft>
      <speed_kt>30</speed_kt>
    </task>

    <task>
      <name>circle</name>
      <nickname>circle_descent</nickname>
    </task>
    
    <task>
      <name>land</name>
      <lateral_offset_m>0.0</lateral_offset_m>
      <glideslope_deg>3.0</glideslope_deg>
      <turn_radius_m>75</turn_radius_m>
      <direction>left</direction>
      <extend_final_leg_m>200</extend_final_leg_m>
      <alt_bias_ft>0</alt_bias_ft>
      <approach_speed_kt>25</approach_speed_kt>
      <flare_pitch_deg>4</flare_pitch_deg>
      <flare_seconds>5.0</flare_seconds>
    </task>
  </standby_tasks>

</PropertyList>
